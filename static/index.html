<!doctype html>
<html>
<head>
<meta charset="utf-8" />
<title>Tramwaje Warszawskie | Paweł Przytuła</title>
<meta name='viewport' content='initial-scale=1,maximum-scale=1,user-scalable=no' />
<link href='https://api.mapbox.com/mapbox.js/v2.4.0/mapbox.css' rel='stylesheet' />
<link rel="stylesheet" href="http://cdn.leafletjs.com/leaflet/v0.7.7/leaflet.css" />
<script src="https://code.jquery.com/jquery-1.12.0.min.js"></script>
<script src="http://cdn.leafletjs.com/leaflet/v0.7.7/leaflet.js"></script>
<script src='https://api.mapbox.com/mapbox.js/v2.4.0/mapbox.js'></script>
<script src="AnimatedMarker.js"></script>

<style>
  body { margin:0; padding:0; }
  #map { position:absolute; top:0; bottom:0; width:100%; }
</style>
</head>

<body>
<div id="map"></div>
<script>
L.mapbox.accessToken = 'pk.eyJ1IjoicHJ6eXR1MSIsImEiOiJjaWtpOWFiM2EwMDM1dnBtNmIxZ25vN3UxIn0.7zanh1pEQeIXyPaiwxDuDg';

var mapboxTiles = L.tileLayer('https://api.mapbox.com/v4/mapbox.streets/{z}/{x}/{y}.png?access_token=' + L.mapbox.accessToken, {
    attribution: '© <a href="https://www.mapbox.com/map-feedback/">Mapbox</a> © <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>'
});

function addAnimatedMarker(map, lineCoords) {
    var line = L.polyline(lineCoords.map(function (coords) { return [coords[1], coords[0]]; }));
    var animatedMarker = L.animatedMarker(line.getLatLngs(), {
      distance: 50,  // meters
      interval: 1000, // milliseconds
    });
    map.addLayer(animatedMarker);
}


var map = L.map('map')
    .addLayer(mapboxTiles)
    .setView([52.231765, 21.035], 12);

$.ajax({dataType: "json", url: "line_scheme_26.geojson",
success: function(geojson) {
  setInterval(function () {
    console.log("interval!")
    L.geoJson(geojson).addTo(map);
    addAnimatedMarker(map, geojson.features[0].geometry.coordinates);
  }, 2000);
}}).error(function() {});
</script>
</body>
</html>